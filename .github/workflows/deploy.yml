name: "Deploy para VPS Windows"
on:
  push:
    branches:
      - main

jobs:
  build_deploy:
    runs-on: windows-latest

    steps:
      - name: "Baixar o c√≥digo"
        uses: actions/checkout@v4

      - name: "Instalar WinRM"
        run: |
          Install-Module -Name 'PSWindowsUpdate' -Force -SkipPublisherCheck
          Install-Module -Name 'Carbon' -Force -SkipPublisherCheck
          Import-Module -Name 'PSWindowsUpdate'
          Import-Module -Name 'Carbon'

      - name: "Copiar arquivos para o servidor Windows"
        uses: menardorama/winrm-action@v2
        with:
          host: ${{ secrets.HOST_SERVER }}
          username: ${{ secrets.EC2_USER }}
          password: ${{ secrets.EC2_PASSWORD }}
          use_tls: true
          script_file: |
            Copy-Item -Path '.' -Destination 'C:\\xampp\\htdocs' -Recurse
